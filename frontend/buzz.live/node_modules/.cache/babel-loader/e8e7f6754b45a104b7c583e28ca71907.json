{"ast":null,"code":"import { io } from \"socket.io-client\";\nimport Peer from \"peerjs\";\nconst activePeers = {};\nvar socket;\n\nfunction initSocketConnection(roomID, setUrl) {\n  const peer = new Peer(undefined, {\n    host: '/',\n    port: '3001'\n  });\n  socket = io(\"http://localhost:5000\");\n  peer.on(\"open\", id => {\n    socket.emit(\"join-room\", roomID, id);\n  });\n  socket.on(\"user-leaved\", userID => {\n    if (activePeers[userID]) {\n      activePeers[userID].close();\n      console.log(\"user removed\");\n    } else {\n      console.log(\"user is not here\");\n    }\n  });\n  navigator.mediaDevices.getUserMedia({\n    video: true,\n    audio: false\n  }).then(yourStream => {\n    peer.on(\"call\", call => {\n      call.answer(yourStream);\n      const video2 = document.createElement(\"video\");\n      call.on(\"stream\", anotherStream => {\n        addVideoStream(video2, anotherStream);\n      });\n    });\n    const video = document.createElement(\"video\");\n    addVideoStream(video, yourStream);\n    socket.on(\"user-joined\", userID => {\n      connectToNewUser(userID, yourStream, peer);\n    });\n  });\n  socket.on(\"play-video\", vID => {\n    console.log(vID);\n    setUrl(`https://www.youtube.com/watch?v=${vID}`);\n  });\n}\n\nfunction addVideoStream(video, stream) {\n  const container = document.getElementById(\"r-video-container\");\n  video.srcObject = stream;\n  video.addEventListener(\"loadedmetadata\", () => {\n    video.play();\n  });\n  container.appendChild(video);\n}\n\nfunction connectToNewUser(userID, yourStream, peer) {\n  const call = peer.call(userID, yourStream);\n  const video = document.createElement(\"video\");\n  call.on(\"stream\", anotherUserstream => {\n    addVideoStream(video, anotherUserstream);\n  });\n  call.on(\"close\", () => {\n    video.remove();\n  });\n  console.log(activePeers + \"peers\");\n}\n\nfunction playVideoToOthers(roomID, videoID) {\n  socket.emit(\"video-playing\", roomID, videoID);\n  console.log(\"play video\");\n}\n\nfunction videoStateChanged(roomID, state) {\n  socket.emit(\"video-state\", roomID, state);\n}\n\nexport { initSocketConnection, playVideoToOthers, videoStateChanged };","map":{"version":3,"sources":["C:/Users/sakth/Documents/Buzz.live/frontend/buzz.live/src/functions/roomConnection.js"],"names":["io","Peer","activePeers","socket","initSocketConnection","roomID","setUrl","peer","undefined","host","port","on","id","emit","userID","close","console","log","navigator","mediaDevices","getUserMedia","video","audio","then","yourStream","call","answer","video2","document","createElement","anotherStream","addVideoStream","connectToNewUser","vID","stream","container","getElementById","srcObject","addEventListener","play","appendChild","anotherUserstream","remove","playVideoToOthers","videoID","videoStateChanged","state"],"mappings":"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","sourcesContent":["import {io} from \"socket.io-client\";\r\nimport Peer from \"peerjs\";\r\n\r\nconst activePeers = {};\r\nvar socket;\r\nfunction initSocketConnection(roomID,setUrl){\r\n    const peer = new Peer(undefined, {\r\n        host: '/',\r\n        port: '3001'\r\n      })\r\n    socket = io(\"http://localhost:5000\")\r\n\r\n    peer.on(\"open\",(id)=>{\r\n        socket.emit(\"join-room\",roomID,id)\r\n    })\r\n\r\n    socket.on(\"user-leaved\",userID=>{\r\n        if(activePeers[userID]){\r\n            activePeers[userID].close();\r\n            console.log(\"user removed\");\r\n        }else{\r\n            console.log(\"user is not here\");\r\n        }\r\n    })\r\n\r\n    navigator.mediaDevices.getUserMedia({\r\n        video:true,\r\n        audio:false,\r\n    }).then((yourStream)=>{\r\n\r\n        peer.on(\"call\",(call)=>{\r\n            call.answer(yourStream);\r\n            const video2 = document.createElement(\"video\")\r\n            call.on(\"stream\",(anotherStream)=>{\r\n                addVideoStream(video2,anotherStream);\r\n            })\r\n        })\r\n\r\n        const video = document.createElement(\"video\")\r\n        addVideoStream(video,yourStream);\r\n\r\n        socket.on(\"user-joined\",(userID)=>{\r\n            connectToNewUser(userID,yourStream,peer);\r\n        })\r\n    })\r\n\r\n    socket.on(\"play-video\",(vID)=>{\r\n        console.log(vID);\r\n        setUrl(`https://www.youtube.com/watch?v=${vID}`)\r\n    })\r\n\r\n}\r\n\r\n\r\n\r\nfunction addVideoStream(video,stream){\r\n    const container = document.getElementById(\"r-video-container\");\r\n    video.srcObject = stream;\r\n    video.addEventListener(\"loadedmetadata\",()=>{\r\n        video.play();\r\n    })\r\n    container.appendChild(video);\r\n}\r\n\r\nfunction connectToNewUser(userID,yourStream,peer){\r\n    const call = peer.call(userID,yourStream);\r\n    const video = document.createElement(\"video\");\r\n    call.on(\"stream\",(anotherUserstream)=>{\r\n        addVideoStream(video,anotherUserstream);\r\n    })\r\n\r\n    call.on(\"close\",()=>{\r\n        video.remove();\r\n    })\r\n    \r\n    console.log(activePeers+\"peers\");\r\n    \r\n}\r\n\r\nfunction playVideoToOthers(roomID,videoID){\r\n    socket.emit(\"video-playing\",roomID,videoID);\r\n    console.log(\"play video\");\r\n}\r\n\r\nfunction videoStateChanged(roomID,state){\r\n    socket.emit(\"video-state\",roomID,state);\r\n}\r\n\r\nexport {initSocketConnection,playVideoToOthers,videoStateChanged};"]},"metadata":{},"sourceType":"module"}