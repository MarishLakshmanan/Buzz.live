{"ast":null,"code":"import { io } from \"socket.io-client\";\nimport Peer from \"peerjs\";\nconst activePeers = {};\nvar socket;\nconst container = document.getElementById(\"r-video-container\");\nconst peer = new Peer(undefined, {\n  host: '/',\n  port: '3001'\n});\n\nfunction initSocketConnection(roomID, playVideoClient, setClinetState, clientRef, createMessage, setView) {\n  socket = io(\"http://localhost:5000\");\n  peer.on(\"open\", id => {\n    const uID = localStorage.getItem(\"id\");\n    socket.emit(\"join-room\", roomID, id, uID);\n  });\n  socket.on(\"user-leaved\", userID => {\n    if (activePeers[userID]) {\n      activePeers[userID].close();\n      console.log(\"user removed\");\n    } else {\n      console.log(\"user is not here\");\n    }\n  });\n  const myVideo = document.createElement(\"video\");\n  myVideo.classList.add(\"user-video\");\n  navigator.mediaDevices.getUserMedia({\n    video: true,\n    audio: false\n  }).then(yourStream => {\n    addVideoStream(myVideo, yourStream);\n    peer.on(\"call\", call => {\n      call.answer(yourStream);\n      const video = document.createElement(\"video\");\n      video.classList.add(\"user-video\");\n      call.on(\"stream\", anotherStream => {\n        addVideoStream(video, anotherStream);\n      });\n    });\n    socket.on(\"user-joined\", userID => {\n      connectToNewUser(userID, yourStream, peer);\n    });\n  });\n  socket.on(\"play-video\", url => {\n    playVideoClient(url);\n  });\n  socket.on(\"state-changed\", (state, seconds) => {\n    if (state) {\n      clientRef.current.seekTo(seconds, \"seconds\");\n    }\n\n    setClinetState(state);\n  });\n  socket.on(\"recieve-message\", msg => {\n    console.log(msg);\n    createMessage(msg);\n  });\n  socket.on(\"user-choice\", choice => {\n    setView(choice);\n  });\n}\n\nfunction addVideoStream(video, stream) {\n  video.srcObject = stream;\n  video.addEventListener(\"loadedmetadata\", () => {\n    video.play();\n  });\n  container.appendChild(video);\n}\n\nfunction connectToNewUser(userID, yourStream, peer) {\n  const call = peer.call(userID, yourStream);\n  const video = document.createElement(\"video\");\n  video.classList.add(\"user-video\");\n  call.on(\"stream\", anotherUserstream => {\n    addVideoStream(video, anotherUserstream);\n  });\n  call.on(\"close\", () => {\n    video.remove();\n  });\n  activePeers[userID] = call;\n}\n\nfunction playVideoToOthers(videoID) {\n  socket.emit(\"video-playing\", videoID);\n}\n\nfunction userChoice(choice) {\n  socket.emit(\"user-choice\", choice);\n}\n\nfunction videoStateChanged(state, seconds) {\n  socket.emit(\"video-state\", state, seconds);\n}\n\nfunction sendMessageToOthers(msg) {\n  socket.emit(\"send-message\", msg);\n}\n\nexport { initSocketConnection, playVideoToOthers, videoStateChanged, sendMessageToOthers, userChoice };","map":{"version":3,"sources":["C:/Users/sakth/Documents/BackUp/Buzz.live/frontend/buzz.live/src/functions/roomConnection.js"],"names":["io","Peer","activePeers","socket","container","document","getElementById","peer","undefined","host","port","initSocketConnection","roomID","playVideoClient","setClinetState","clientRef","createMessage","setView","on","id","uID","localStorage","getItem","emit","userID","close","console","log","myVideo","createElement","classList","add","navigator","mediaDevices","getUserMedia","video","audio","then","yourStream","addVideoStream","call","answer","anotherStream","connectToNewUser","url","state","seconds","current","seekTo","msg","choice","stream","srcObject","addEventListener","play","appendChild","anotherUserstream","remove","playVideoToOthers","videoID","userChoice","videoStateChanged","sendMessageToOthers"],"mappings":"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","sourcesContent":["import {io} from \"socket.io-client\";\r\nimport Peer from \"peerjs\";\r\n\r\nconst activePeers ={};\r\nvar socket\r\nconst container = document.getElementById(\"r-video-container\");\r\nconst peer = new Peer(undefined, {\r\n    host: '/',\r\n    port: '3001'\r\n  })\r\nfunction initSocketConnection(roomID,playVideoClient,setClinetState,clientRef,createMessage,setView){\r\n    \r\n    socket = io(\"http://localhost:5000\")\r\n\r\n    peer.on(\"open\",(id)=>{\r\n        const uID = localStorage.getItem(\"id\");\r\n        socket.emit(\"join-room\",roomID,id,uID)\r\n    })\r\n\r\n    socket.on(\"user-leaved\",userID=>{\r\n        if(activePeers[userID]){\r\n            activePeers[userID].close();\r\n            console.log(\"user removed\");\r\n        }else{\r\n            console.log(\"user is not here\");\r\n        }\r\n    })\r\n\r\n    const myVideo = document.createElement(\"video\")\r\n    myVideo.classList.add(\"user-video\")\r\n    navigator.mediaDevices.getUserMedia({\r\n        video:true,\r\n        audio:false,\r\n    }).then((yourStream)=>{\r\n        addVideoStream(myVideo,yourStream);\r\n        peer.on(\"call\",(call)=>{\r\n            call.answer(yourStream);\r\n            const video = document.createElement(\"video\")\r\n            video.classList.add(\"user-video\")\r\n            call.on(\"stream\",(anotherStream)=>{\r\n                addVideoStream(video,anotherStream);\r\n            })\r\n        })\r\n        \r\n\r\n        socket.on(\"user-joined\",(userID)=>{\r\n            connectToNewUser(userID,yourStream,peer);\r\n        })\r\n    })\r\n\r\n    socket.on(\"play-video\",(url)=>{\r\n        playVideoClient(url);\r\n    })\r\n\r\n    socket.on(\"state-changed\",(state,seconds)=>{\r\n        if(state){\r\n            clientRef.current.seekTo(seconds,\"seconds\");\r\n        }\r\n        setClinetState(state) \r\n    })\r\n\r\n    socket.on(\"recieve-message\",(msg)=>{\r\n        console.log(msg);\r\n        createMessage(msg);\r\n    })\r\n\r\n    socket.on(\"user-choice\",(choice)=>{\r\n        setView(choice)\r\n    })\r\n\r\n}\r\n\r\n\r\n\r\nfunction addVideoStream(video,stream){\r\n    video.srcObject = stream;\r\n    video.addEventListener(\"loadedmetadata\",()=>{\r\n        video.play();\r\n    })\r\n    container.appendChild(video);\r\n}\r\n\r\nfunction connectToNewUser(userID,yourStream,peer){\r\n    const call = peer.call(userID,yourStream);\r\n    const video = document.createElement(\"video\");\r\n    video.classList.add(\"user-video\")\r\n    call.on(\"stream\",(anotherUserstream)=>{\r\n        addVideoStream(video,anotherUserstream);\r\n    })\r\n\r\n    call.on(\"close\",()=>{\r\n        video.remove();\r\n    })\r\n\r\n    activePeers[userID]=call;\r\n}\r\n\r\n\r\n\r\nfunction playVideoToOthers(videoID){\r\n    socket.emit(\"video-playing\",videoID);\r\n}\r\n\r\nfunction userChoice(choice){\r\n    socket.emit(\"user-choice\",choice);\r\n}\r\n\r\nfunction videoStateChanged(state,seconds){\r\n    socket.emit(\"video-state\",state,seconds);\r\n}\r\n\r\nfunction sendMessageToOthers(msg){\r\n    socket.emit(\"send-message\",msg);\r\n}\r\n\r\nexport {initSocketConnection,playVideoToOthers,videoStateChanged,sendMessageToOthers,userChoice};"]},"metadata":{},"sourceType":"module"}